<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  getDocs,
  deleteDoc,
  doc,
  query,
  orderBy
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDk_hyA2kEsJZhOOFzmsdiTsdWwptpMGNc",
  authDomain: "siir-defteri.firebaseapp.com",
  projectId: "siir-defteri",
  storageBucket: "siir-defteri.firebasestorage.app",
  messagingSenderId: "568234838204",
  appId: "1:568234838204:web:76c1f3d7f69ba5e32968b9"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ðŸ”¥ ÅžÄ°Ä°RLERÄ° YÃœKLE
window.renderPoems = async function(isAdmin=false){
  const poemsDiv = document.getElementById('poems');
  poemsDiv.innerHTML='';

  const q = query(collection(db,"poems"), orderBy("date","desc"));
  const snap = await getDocs(q);

  snap.forEach(d=>{
    const p = d.data();
    const page=document.createElement('div');
    page.className='page';
    page.innerHTML=`
      <div class="poem-title">${p.title}</div>
      <pre>${p.content}</pre>
      <div class="poem-date">
        ${p.date?.seconds ? new Date(p.date.seconds*1000).toLocaleString('tr-TR') : ''}
      </div>
      ${isAdmin?`<button class="delete-btn" onclick="deletePoem('${d.id}')">Sil</button>`:''}
    `;
    poemsDiv.appendChild(page);
  });
}

// ðŸ”¥ EKLE
window.addPoem = async function(){
  if(!title.value||!content.value) return;
  await addDoc(collection(db,"poems"),{
    title:title.value,
    content:content.value,
    date:new Date()
  });
  title.value='';
  content.value='';
  renderPoems(true);
}

// ðŸ”¥ SÄ°L
window.deletePoem = async function(id){
  await deleteDoc(doc(db,"poems",id));
  renderPoems(true);
}
</script>
