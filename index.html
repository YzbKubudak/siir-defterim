<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Åžiir Defterim</title>

<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;600&display=swap" rel="stylesheet">

<style>
body, button, input, textarea, h1, h2, h3, p, pre, div{
  font-family: 'Dancing Script', cursive;
}

body{
  margin:0;
  background:#87ceeb;
  transition:background .4s;
}

body.night{ background:#0f1c2e; }
.sair-btn{
  display:inline-block;
  margin:10px;
  padding:10px 18px;
  background:#3b2f2f;
  color:white;
  border-radius:20px;
  cursor:pointer;
  font-size:22px;
}

#entry{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

#entry-box{
  background:white;
  padding:30px;
  border-radius:12px;
  text-align:center;
}

header{
  background:#87ceeb;
  padding:25px;
  text-align:center;
  position:relative;
}

header h1{
  font-size:96px;
  text-shadow:2px 2px 4px rgba(0,0,0,.35);
}

header p{ font-size:38px; }

.admin-btn{
  position:absolute;
  top:20px;
  padding:8px 18px;
  background:#3b2f2f;
  color:white;
  border-radius:20px;
  cursor:pointer;
}

.admin{ right:20px; }
.night-btn{ right:140px; }

.page{
  max-width:780px;
  margin:60px auto;
  padding:50px;
  background:linear-gradient(180deg,#f8e7b1,#f4dea0);
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.25);
}

.poem-title{
  font-size:48px;
  text-align:center;
}

pre{
  white-space:pre-wrap;
  font-size:26px;
  text-align:center;
}

.delete-btn{
  margin-top:20px;
  background:#a33;
  color:white;
  border:none;
  padding:8px 14px;
  border-radius:6px;
  cursor:pointer;
}
body.night header{
  background:#0b1626;
}

body.night header h1,
body.night header p{
  color:#f2f2f2;
  text-shadow:
    0 0 6px rgba(255,255,255,.4),
    0 0 14px rgba(120,170,255,.5);
}

body.night .page{
  background:linear-gradient(180deg,#161616,#0e0e0e);
  color:#f0f0f0;
  box-shadow:
    inset 0 0 80px rgba(0,0,0,.85),
    inset 0 0 140px rgba(0,0,0,.7),
    0 10px 30px rgba(0,0,0,.7);
}

#adminPanel{ display:none; }

input, textarea, button{ font-size:22px; }

@media (max-width:768px){
  header h1{ font-size:56px; }
  header p{ font-size:26px; }
}
</style>
</head>

<body>

<div id="entry">
  <div id="entry-box">
    <h2>Bu defter kilitli</h2>
    <input type="password" id="entryPass" placeholder="Åžifre"><br><br>
    <button onclick="enterSite()">GiriÅŸ</button>
  </div>
</div>

<div id="site" style="display:none;">
<header>
  <h1>Åžiir Defterim</h1>
  <p>Kalbimden Sana Sevgilim</p>

  <div class="admin-btn night-btn" onclick="toggleNight()">ðŸŒ™</div>
  <div class="admin-btn admin" onclick="showAdmin()">YÃ¶netici</div>
</header>

<div id="adminPanel" class="page">
  <h2>Yeni Åžiir Ekle</h2>
  <input id="title" placeholder="Åžiir baÅŸlÄ±ÄŸÄ±"><br><br>
  <textarea id="content" rows="6" placeholder="Åžiiri yaz..."></textarea><br><br>

  <h3>Åžair SeÃ§</h3>
  <select id="sairSelect" onchange="renderPoems(true)"></select><br><br>

  <button onclick="addPoem()">Åžiiri Ekle</button>

  <hr>

  <h2>Yeni Åžair Ekle</h2>
  <input id="sairName" placeholder="Åžair adÄ±"><br><br>
  <button onclick="addSair()">Åžair Ekle</button>
</div>
<div id="sairler" class="page">
  <h2 style="text-align:center;">ðŸ“œ Åžairler</h2>
  <div id="sairList" style="text-align:center;"></div>
</div>
<hr>
<button class="delete-btn" onclick="deleteSair()">
  SeÃ§ili Åžairi Sil
</button>

<div id="poems"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import {
  getFirestore, collection, addDoc, getDocs,
  deleteDoc, doc, query, orderBy, setDoc
} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

const ENTRY_PASSWORD = "2808";
const ADMIN_PASSWORD = "0828";

const firebaseConfig = {
  apiKey: "AIzaSyDk_hyA2kEsJZhOOFzmsdiTsdWwptpMGNc",
  authDomain: "siir-defteri.firebaseapp.com",
  projectId: "siir-defteri",
  storageBucket: "siir-defteri.firebasestorage.app",
  messagingSenderId: "568234838204",
  appId: "1:568234838204:web:76c1f3d7f69ba5e32968b9"
};
// ðŸŒ™ GECE MODU HATIRLAMA
if(localStorage.getItem("nightMode")==="true"){
  document.body.classList.add("night");
}

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.toggleNight = function(){
  document.body.classList.toggle("night");
  localStorage.setItem(
    "nightMode",
    document.body.classList.contains("night")
  );
}

window.enterSite = function(){
  if(entryPass.value===ENTRY_PASSWORD){
    entry.style.display="none";
    site.style.display="block";
    loadSairler(false);   // ðŸ‘ˆ ZÄ°YARETÃ‡Ä°
  } else alert("Åžifre yanlÄ±ÅŸ");
}

window.showAdmin = function(){
  const pass = prompt("YÃ¶netici ÅŸifresi");
  if(pass===ADMIN_PASSWORD){
    adminPanel.style.display="block";
    loadSairler(true);   // ðŸ‘ˆ ADMÄ°N
  }
}

window.loadSairler = async function(isAdmin){
  sairList.innerHTML="";
  sairSelect.innerHTML="";

  const snap = await getDocs(collection(db,"sairler"));

  snap.forEach(d=>{
    const name = d.data().name;

    window.loadPoemsOfSair = async function(sairId,isAdmin){
  poems.innerHTML="";
  const q = query(
    collection(db,"sairler",sairId,"poems"),
    orderBy("date","desc")
  );

  const snap = await getDocs(q);

  snap.forEach(d=>{
    const p = d.data();
    const div = document.createElement("div");
    div.className="page";
    div.innerHTML=`
      <div class="poem-title">${p.title}</div>
      <pre>${p.content}</pre>
      <div style="text-align:center;opacity:.6">
        ${new Date(p.date.seconds*1000).toLocaleString("tr-TR")}
      </div>
      ${isAdmin ? `<button class="delete-btn" onclick="deletePoem('${sairId}','${d.id}')">Sil</button>` : ""}
    `;
    poems.appendChild(div);
  });
}
window.deleteSair = async function(){
  const sairId = sairSelect.value;
  if(!sairId) return;

  if(!confirm("Åžair ve tÃ¼m ÅŸiirleri silinsin mi?")) return;

  const poemsSnap = await getDocs(
    collection(db,"sairler",sairId,"poems")
  );

  for(const d of poemsSnap.docs){
    await deleteDoc(d.ref);
  }

  await deleteDoc(doc(db,"sairler",sairId));

  poems.innerHTML="";
  loadSairler(true);
}

    // ANA EKRAN BUTONU
    const btn = document.createElement("div");
    btn.className="sair-btn";
    btn.textContent = name;
    btn.onclick = ()=> loadPoemsOfSair(d.id, isAdmin);
    sairList.appendChild(btn);

    // ADMÄ°N SELECT
    if(isAdmin){
      const opt = document.createElement("option");
      opt.value = d.id;
      opt.textContent = name;
      sairSelect.appendChild(opt);
    }
  });
}

window.addSair = async function(){
  if(!sairName.value) return;
  const id=sairName.value.toLowerCase().replace(/\s+/g,"-");
  await setDoc(doc(db,"sairler",id),{ name:sairName.value });
  sairName.value="";
  loadSairler();
}

window.addPoem = async function(){
  if(!title.value||!content.value||!sairSelect.value) return;
  await addDoc(collection(db,"sairler",sairSelect.value,"poems"),{
    title:title.value,
    content:content.value,
    date:new Date()
  });
  title.value="";
  content.value="";
  renderPoems(true);
}

window.renderPoems = async function(isAdmin){
  poems.innerHTML="";
  if(!sairSelect.value) return;
  const q=query(
    collection(db,"sairler",sairSelect.value,"poems"),
    orderBy("date","desc")
  );
  const snap=await getDocs(q);
  snap.forEach(d=>{
    const p=d.data();
    poems.innerHTML+=`
      <div class="page">
        <div class="poem-title">${p.title}</div>
        <pre>${p.content}</pre>
        ${isAdmin?`<button class="delete-btn"
        onclick="deletePoem('${sairSelect.value}','${d.id}')">Sil</button>`:""}
      </div>`;
  });
}

window.deletePoem = async function(sairId,id){
  await deleteDoc(doc(db,"sairler",sairId,"poems",id));
  renderPoems(true);
}
</script>

</body>
</html>
