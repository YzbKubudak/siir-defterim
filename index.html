<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Åžiir Defterim</title>

<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;600&display=swap" rel="stylesheet">

<style>
*{font-family:'Dancing Script',cursive}
body{margin:0;background:#87ceeb;transition:.4s}
body.night{background:#0f1c2e}
header{padding:25px;text-align:center;position:relative}
header h1{font-size:90px}
header p{font-size:36px}
.admin-btn{position:absolute;top:20px;padding:8px 18px;
background:#3b2f2f;color:white;border-radius:20px;cursor:pointer}
.admin{right:20px}
.night-btn{right:140px}
.page{max-width:800px;margin:50px auto;padding:40px;
background:linear-gradient(#f8e7b1,#f4dea0);border-radius:14px}
.sair-btn{display:inline-block;margin:10px;padding:10px 18px;
background:#3b2f2f;color:white;border-radius:20px;cursor:pointer;font-size:22px}
.poem-title{font-size:46px;text-align:center}
pre{white-space:pre-wrap;font-size:26px;text-align:center}
.delete-btn{background:#a33;color:white;border:none;
padding:8px 14px;border-radius:6px;cursor:pointer}
#adminPanel{display:none}
#entry{min-height:100vh;display:flex;align-items:center;justify-content:center}
#entry-box{background:white;padding:30px;border-radius:12px;text-align:center}
</style>
</head>

<body>

<div id="entry">
  <div id="entry-box">
    <h2>Bu defter kilitli</h2>
    <input id="entryPass" type="password" placeholder="Åžifre"><br><br>
    <button onclick="enterSite()">GiriÅŸ</button>
  </div>
</div>

<div id="site" style="display:none">
<header>
  <h1>Åžiir Defterim</h1>
  <p>Kalbimden Sana Sevgilim</p>
  <div class="admin-btn night-btn" onclick="toggleNight()">ðŸŒ™</div>
  <div class="admin-btn admin" onclick="showAdmin()">YÃ¶netici</div>
</header>

<div id="adminPanel" class="page">
  <h2>Yeni Åžair</h2>
  <input id="sairName" placeholder="Åžair adÄ±">
  <button onclick="addSair()">Ekle</button>
  <hr>
  <h2>Yeni Åžiir</h2>
  <select id="sairSelect"></select><br><br>
  <input id="title" placeholder="BaÅŸlÄ±k"><br><br>
  <textarea id="content" rows="5" placeholder="Åžiir..."></textarea><br><br>
  <button onclick="addPoem()">Åžiiri Ekle</button><br><br>
  <button class="delete-btn" onclick="deleteSair()">SeÃ§ili Åžairi Sil</button>
</div>

<div class="page">
  <h2 style="text-align:center">ðŸ“œ Åžairler</h2>
  <div id="sairList" style="text-align:center"></div>
</div>

<div id="poems"></div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

<script>
const ENTRY_PASSWORD="2808";
const ADMIN_PASSWORD="0828";

const firebaseConfig={
  apiKey:"AIzaSyDk_hyA2kEsJZhOOFzmsdiTsdWwptpMGNc",
  authDomain:"siir-defteri.firebaseapp.com",
  projectId:"siir-defteri",
};

firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

if(localStorage.night==="1")document.body.classList.add("night");
function toggleNight(){
  document.body.classList.toggle("night");
  localStorage.night=document.body.classList.contains("night")?"1":"0";
}

function enterSite(){
  if(entryPass.value===ENTRY_PASSWORD){
    entry.style.display="none";
    site.style.display="block";
    loadSairler(false);
  }else alert("Åžifre yanlÄ±ÅŸ");
}

function showAdmin(){
  if(prompt("YÃ¶netici ÅŸifresi")==ADMIN_PASSWORD){
    adminPanel.style.display="block";
    loadSairler(true);
  }
}

async function loadSairler(admin){
  sairList.innerHTML="";
  sairSelect.innerHTML="";
  const snap=await db.collection("sairler").get();
  snap.forEach(d=>{
    const b=document.createElement("div");
    b.className="sair-btn";
    b.textContent=d.data().name;
    b.onclick=()=>loadPoems(d.id,admin);
    sairList.appendChild(b);
    if(admin){
      const o=document.createElement("option");
      o.value=d.id;o.textContent=d.data().name;
      sairSelect.appendChild(o);
    }
  });
}

async function loadPoems(id,admin){
  poems.innerHTML="";
  const snap=await db.collection("sairler").doc(id)
    .collection("poems").orderBy("date","desc").get();
  snap.forEach(d=>{
    const p=d.data();
    poems.innerHTML+=`
    <div class="page">
      <div class="poem-title">${p.title}</div>
      <pre>${p.content}</pre>
      ${admin?`<button class="delete-btn"
      onclick="deletePoem('${id}','${d.id}')">Sil</button>`:""}
    </div>`;
  });
}

function addSair(){
  if(!sairName.value)return;
  const id=sairName.value.toLowerCase().replace(/\s+/g,"-");
  db.collection("sairler").doc(id).set({name:sairName.value});
  sairName.value="";
  loadSairler(true);
}

function addPoem(){
  if(!title.value||!content.value)return;
  db.collection("sairler").doc(sairSelect.value)
    .collection("poems").add({
      title:title.value,
      content:content.value,
      date:new Date()
    });
  title.value="";content.value="";
}

function deletePoem(sair,id){
  db.collection("sairler").doc(sair)
    .collection("poems").doc(id).delete();
}

async function deleteSair(){
  const id=sairSelect.value;
  if(!confirm("Åžair ve tÃ¼m ÅŸiirler silinsin mi?"))return;
  const snap=await db.collection("sairler").doc(id)
    .collection("poems").get();
  snap.forEach(d=>d.ref.delete());
  db.collection("sairler").doc(id).delete();
  poems.innerHTML="";
  loadSairler(true);
}
</script>

</body>
</html>
